\documentclass[uplatex,dvipdfmx]{jsarticle}
\usepackage{tcolorbox}
\usepackage{ascolorbox} % tetsuryoku

\usepackage{multicol}
\usepackage{amsmath,amssymb,amsthm}

\usepackage{tikz}
\usepackage{tikz-cd}
\RequirePackage{tikz,tcolorbox,varwidth,multicol}

\usetikzlibrary{calc}
\tcbuselibrary{xparse,hooks,skins,breakable}

\tcbuselibrary{many}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\theoremstyle{definition}
\newtheorem{theorem}{定理}[section]
\newtheorem{proposition}[theorem]{命題}
\newtheorem{definition}[theorem]{定義}
\newtheorem{lemma}[theorem]{補題}
\newtheorem{corollary}[theorem]{系}
\newtheorem{remark}[theorem]{注意}
\newtheorem*{remark*}{注意}
\newtheorem{example}[theorem]{例}
\newtheorem{aside}[theorem]{補足}
\newtheorem{problem}[theorem]{問題}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\tcolorboxenvironment{theorem}{
  enhanced,
  sharp corners,
  breakable,
  colback=white,
  top=2pt,bottom=2pt,left=4pt,right=4pt,
  boxrule=1pt,
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\tcolorboxenvironment{proposition}
{enhanced, colback=white, colframe=white,
fonttitle=\bfseries, coltitle=black, fonttitle=\gtfamily, 
breakable, sharp corners,
top=2pt,bottom=2pt,left=2pt,right=2pt,
underlay unbroken and first={
  \draw[black,line width=1pt,]
  (frame.north west) -- (frame.north east);
  \draw[black!40!white,line width=1pt, dotted]
  ([yshift=-3pt]frame.north west) -- ([yshift=-3pt]frame.north east);
  },
underlay unbroken and last={
  \draw[black,line width=1pt,]
  (frame.south west) -- (frame.south east);
  \draw[black!40!white,line width=1pt, dotted]
  ([yshift=3pt]frame.south west) -- ([yshift=3pt]frame.south east);
  }
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\tcolorboxenvironment{definition}
{enhanced, colback=white, colframe=white,
 fonttitle=\bfseries, coltitle=black, fonttitle=\gtfamily, 
enlarge top by=2mm, enlarge bottom by=2mm, breakable,
top=2pt,bottom=2pt,left=6pt,right=6pt,
underlay unbroken={
  \draw[black!40!white,line width=.5pt]
  ([xshift=2pt]frame.north west)--([xshift=-2pt]frame.north east) 
  -- ++ (0,-2pt);
  \draw[black!40!white,line width=.5pt]
  ([xshift=-2*4.5pt]frame.north east) -- ++ (0,-2*3.5pt) -- ++ (2pt,0);
  \draw[black!40!white,line width=.5pt]
  ([yshift=-2pt]frame.north west)--([yshift=-2pt,xshift=-2*6pt]frame.north east);
  \draw[black!40!white,line width=.5pt]
  ([xshift=2pt]frame.north west)--([xshift=2pt]frame.north west) 
  -- ([xshift=2pt,yshift=2*6pt]frame.south west);
  \draw[black!40!white,line width=.5pt]
  ([yshift=-2pt]frame.north west)--([yshift=-2pt]frame.north west) 
  -- ([yshift=2pt]frame.south west) -- ++ (2pt,0);
  \draw[black!40!white,line width=.5pt]
  ([yshift=2*4.5pt]frame.south west) -- ++ (2*3.5pt,0) -- ++ (0,-2pt);
  \draw[black,line width=.5pt]
  ([xshift=-2pt,yshift=-2pt]frame.north east) -- ++ (2pt,0) -- ([yshift=2pt]frame.south east) -- ([xshift=2*6pt,yshift=2pt]frame.south west);
  \draw[black,line width=.5pt]
  ([xshift=-2*3.5pt,yshift=-2*3.5pt]frame.north east) -- ++ (0,-2pt) -- ++ (2*3.5pt,0);
  \draw[black,line width=.5pt]
  ([xshift=-2pt,yshift=-2*6pt]frame.north east) -- ([xshift=-2pt]frame.south east) -- ([xshift=2pt]frame.south west) -- ++ (0,2pt);
  \draw[black,line width=.5pt]
  ([xshift=2*4.5pt]frame.south west) -- ++ (0,2*3.5pt) -- ++ (-2pt,0);
  \fill[black!70!white,line width=.5pt]
  ([xshift=-2pt,yshift=-2pt]frame.north east) -- ++ (0,-2*2.5pt) -- ++ (-2*2.5pt,0) -- ++ (0,2*2.5pt) -- cycle;
  \fill[black!70!white,line width=.5pt]
  ([xshift=2pt,yshift=2pt]frame.south west) -- ++ (0,2*2.5pt) -- ++ (2*2.5pt,0) -- ++ (0,-2*2.5pt) -- cycle;
  },
underlay first={
  \draw[black!40!white,line width=.5pt]
  ([xshift=-2pt]frame.north east) -- ++ (0,-2pt);
  \draw[black!40!white,line width=.5pt]
  ([xshift=-2*4.5pt]frame.north east) -- ++ (0,-2*3.5pt) -- ++ (2pt,0);
  \draw[black!40!white,line width=.5pt]
  ([xshift=-2pt]frame.north east)--([xshift=2pt]frame.north west) 
  -- ([xshift=2pt]frame.south west);
  \draw[black!40!white,line width=.5pt]
  ([xshift=-2*4.5pt,yshift=-2pt]frame.north east)--([yshift=-2pt]frame.north west) 
  -- (frame.south west);
  \draw[black,line width=.5pt]
  ([xshift=-2pt,yshift=-2pt]frame.north east) -- ++ (2pt,0) -- (frame.south east);
  \draw[black,line width=.5pt]
  ([xshift=-2*3.5pt,yshift=-2*3.5pt]frame.north east) -- ++ (0,-2pt) -- ++ (2*3.5pt,0);
  \draw[black,line width=.5pt]
  ([xshift=-2pt,yshift=-2*6pt]frame.north east) -- ([xshift=-2pt]frame.south east);
  \fill[black!70!white,line width=.5pt]
  ([xshift=-2pt,yshift=-2pt]frame.north east) -- ++ (0,-2*2.5pt) -- ++ (-2*2.5pt,0) -- ++ (0,2*2.5pt) -- cycle;
  },
underlay middle={\draw[black!40!white,line width=.5pt]
  (frame.north west)--(frame.south west) ;
  \draw[black!40!white,line width=.5pt]
  ([xshift=2pt]frame.north west)--([xshift=2pt]frame.south west) ;
  \draw[black,line width=.5pt]
  (frame.north east)--(frame.south east) ;
  \draw[black,line width=.5pt]
  ([xshift=-2pt]frame.north east)--([xshift=-2pt]frame.south east) ;
  },
underlay last={
  \draw[black!40!white,line width=.5pt]
  ([xshift=2pt]frame.north west) -- ([xshift=2pt,yshift=2*6pt]frame.south west);
  \draw[black!40!white,line width=.5pt]
  (frame.north west) -- ([yshift=2pt]frame.south west) -- ++ (2pt,0);
  \draw[black!40!white,line width=.5pt]
  ([yshift=2*4.5pt]frame.south west) -- ++ (2*3.5pt,0) -- ++ (0,-2pt);
  \draw[black,line width=.5pt]
  (frame.north east) -- ([yshift=2pt]frame.south east) -- ([xshift=2*6pt,yshift=2pt]frame.south west);
  \draw[black,line width=.5pt]
  ([xshift=-2pt]frame.north east) -- ([xshift=-2pt]frame.south east) -- ([xshift=2pt]frame.south west) -- ++ (0,2pt);
  \draw[black,line width=.5pt]
  ([xshift=2*4.5pt]frame.south west) -- ++ (0,2*3.5pt) -- ++ (-2pt,0);
  \fill[black!70!white,line width=.5pt]
  ([xshift=2pt,yshift=2pt]frame.south west) -- ++ (0,2*2.5pt) -- ++ (2*2.5pt,0) -- ++ (0,-2*2.5pt) -- cycle;
  },
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\tcolorboxenvironment{lemma}{
  enhanced,
  sharp corners,
  breakable,
  colback=white,
  top=0pt,bottom=0pt,left=1mm,right=0pt,
  boxrule=0.5pt
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\tcolorboxenvironment{corollary}
{enhanced, colback=white, colframe=white,
 fonttitle=\bfseries,coltitle=black, fonttitle=\gtfamily, 
enlarge top by=2mm, enlarge bottom by=2mm, breakable, 
top=3pt,bottom=3pt,left=3pt,right=3pt,
underlay unbroken={
  %in
  \draw[black,line width =.5]
  ([xshift=2pt]frame.north west)
  --([xshift=-2pt]frame.north east)
  -- ([xshift=-2pt]frame.south east) 
  -- ([xshift=2pt]frame.south west) 
  -- ([xshift=2pt]frame.north west);
  %out
  \draw[black,line width=.5pt]
  ([yshift=2pt]frame.north west)
  --([yshift=2pt]frame.north east)
  -- ([yshift=-2pt]frame.south east) 
  -- ([yshift=-2pt]frame.south west) 
  -- ([yshift=2pt]frame.north west);
  },
underlay first={
  %in
  \draw[black,line width =.5]
  ([xshift=2pt]frame.north west)
  --([xshift=-2pt]frame.north east);
  \draw[black,line width =.5]
  -- ([xshift=2pt]frame.south west) 
  -- ([xshift=2pt]frame.north west);
  %out
  \draw[black,line width=.5pt]
  ([yshift=2pt]frame.north west)
  --([yshift=2pt]frame.north east);
  \draw[black,line width =.5]
  ([yshift=-2pt]frame.south west) 
  -- ([yshift=2pt]frame.north west);  
  },
underlay middle={
  %in
  \draw[black,line width =.5]
  ([xshift=-2pt]frame.north east)
  -- ([xshift=-2pt]frame.south east) 
  \draw[black,line width =.5]
  ([xshift=2pt]frame.south west) 
  -- ([xshift=2pt]frame.north west);
  %out
  \draw[black,line width=.5pt]
  (frame.north east)
  -- (frame.south east);
  \draw[black,line width=.5pt]
  (frame.south west) 
  -- (frame.north west);  
  },
underlay last={
  %in
  \draw[black,line width =.5]
  ([xshift=-2pt,yshift=2pt]frame.north east)
  -- ([xshift=-2pt]frame.south east) 
  -- ([xshift=2pt]frame.south west) 
  -- ([xshift=2pt,yshift=2pt]frame.north west);
  %out
  \draw[black,line width=.5pt]
  ([yshift=2pt]frame.north east)
  -- ([yshift=-2pt]frame.south east) 
  -- ([yshift=-2pt]frame.south west) 
  -- ([yshift=2pt]frame.north west);  
  },
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\renewcommand{\proofname}{\textbf{証明}}

\tcolorboxenvironment{proof}
{enhanced, colback=white, colframe=white,
fonttitle=\bfseries, coltitle=black, fonttitle=\gtfamily, 
breakable, sharp corners,
top=2pt,bottom=2pt,left=2pt,right=2pt,
underlay unbroken={
  \filldraw[fill=gray,draw=gray]
  (frame.south west) -- +(2.5pt,0pt) -- +(2.5pt,5pt) -- +(-2.5pt,5pt) -- (-2.5pt,0pt) -- cycle;
  \filldraw[fill=gray,draw=gray]
  (frame.north west) -- +(2.5pt,0pt) -- +(2.5pt,-5pt) -- +(-2.5pt,-5pt) -- +(-2.5pt,0pt) -- cycle;
  \draw[draw=gray,dotted,line width=.5pt]
  (frame.north west)--(frame.south west) ;
  },
underlay first={
  \filldraw[fill=gray,draw=gray]
  (frame.north west) -- +(2.5pt,0pt) -- +(2.5pt,-5pt) -- +(-2.5pt,-5pt) -- +(-2.5pt,0pt) -- cycle;
  \draw[draw=gray,dotted,line width=.5pt]
  (frame.north west)--(frame.south west) ;
  },
underlay middle={
  \draw[draw=gray,dotted,line width=.5pt]
  (frame.south west)--(frame.north west) ;
  },
underlay last={
  \filldraw[fill=gray,draw=gray]
  (frame.south west) -- +(2.5pt,0pt) -- +(2.5pt,5pt) -- +(-2.5pt,5pt) -- (-2.5pt,0pt) -- cycle;
  \draw[draw=gray,dotted,line width=.5pt]
  (frame.south west)--(frame.north west) ;
  }
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\tcolorboxenvironment{example}
{enhanced, colback=white, colframe=white,
 fonttitle=\bfseries,coltitle=black, fonttitle=\gtfamily, 
enlarge top by=2mm, enlarge bottom by=2mm, breakable, 
top=2pt,bottom=2pt,left=6pt,right=6pt,
underlay unbroken={
  \draw[gray!40!white,line width=.5pt]
  ([xshift=4pt,yshift=-4*0.5pt]frame.north west)--([yshift=-4*0.5pt]frame.north east) -- ++ (0pt,4pt) -- ++ (-4pt,0pt)
  -- ([xshift=-4pt]frame.south east) - ++ (4pt,0pt) -- ++ (4pt,4pt)
  -- ([yshift=4pt]frame.south west) - ++ (0pt,-4pt) -- ++ (4pt,-4pt)
  -- ([xshift=4pt,yshift=4*0.5pt]frame.north west) - ++ (-4pt,0pt) -- ++ (-4pt,-4pt)
  -- ([yshift=-4*0.5pt]frame.north west) - ++(4pt,0pt) ;
  \draw[black,line width=.5pt]
  ([xshift=4*2pt,yshift=4*0.5pt]frame.north west)--([xshift=-4*2pt,yshift=4*0.5pt]frame.north east) -- ++ (0pt,-4*2pt)
  --  ++ (4*2pt,0pt)
  -- ([yshift=4*2pt]frame.south east) -- ++ (-4*2pt,0pt)
  -- ([xshift=-4*2pt]frame.south east)
  -- ([xshift=4*2pt]frame.south west) -- ++ (0pt,4*2pt)
  -- ([yshift=4*2pt]frame.south west)
  -- ([yshift=-4*1.5pt]frame.north west) -- ++ (4*2pt,0pt)
  -- ++ (0pt,4*2pt);},
underlay first={
  \draw[gray!40!white,line width=.5pt]
  ([yshift=-4*0.5pt]frame.north west)--([yshift=-4*0.5pt]frame.north east) -- ++ (0pt,4pt) -- ++ (-4pt,0pt)
  -- ([xshift=-4pt]frame.south east);
  \draw[gray!40!white,line width=.5pt]
  ([xshift=4pt]frame.south west)
  -- ([xshift=4pt,yshift=4*0.5pt]frame.north west) - ++ (-4pt,0pt) -- ++ (-4pt,-4pt)
  -- ([yshift=-4*0.5pt]frame.north west) ;
  \draw[black,line width=.5pt]
  ([xshift=4*2pt,yshift=4*0.5pt]frame.north west)--([xshift=-4*2pt,yshift=4*0.5pt]frame.north east) -- ++ (0pt,-4*2pt)
  --  ++ (4*2pt,0pt)
  -- (frame.south east);
  \draw[black,line width=.5pt]
  (frame.south west)
  -- ([yshift=4*2pt]frame.south west)
  -- ([yshift=-4*1.5pt]frame.north west) -- ++ (4*2pt,0pt)
  -- ++ (0pt,4*2pt);
  },
underlay middle={
  \draw[gray!40!white,line width=.5pt]
  ([xshift=-4pt]frame.north east)
  -- ([xshift=-4pt]frame.south east);
  \draw[gray!40!white,line width=.5pt]
  ([xshift=4pt]frame.north west)
  -- ([xshift=4pt]frame.south west);
  \draw[black,line width=.5pt]
  (frame.north east)
  -- (frame.south east);
  \draw[black,line width=.5pt]
  (frame.north west)
  -- (frame.south west);
  },
underlay last={
  \draw[gray!40!white,line width=.5pt]
  ([xshift=-4pt]frame.north east)
  -- ([xshift=-4pt]frame.south east) - ++ (4pt,0pt) -- ++ (4pt,4pt)
  -- ([yshift=4pt]frame.south west) - ++ (0pt,-4pt) -- ++ (4pt,-4pt)
  -- ([xshift=4pt]frame.north west);
  \draw[black,line width=.5pt]
  (frame.north east)
  -- ([yshift=4*2pt]frame.south east) -- ++ (-4*2pt,0pt)
  -- ([xshift=-4*2pt]frame.south east)
  -- ([xshift=4*2pt]frame.south west) -- ++ (0pt,4*2pt)
  -- ([yshift=4*2pt]frame.south west)
  -- (frame.north west);
  },
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\tcolorboxenvironment{problem}
{enhanced, colback=white, colframe=white,
fonttitle=\bfseries, coltitle=black, fonttitle=\gtfamily, 
breakable, sharp corners,
boxed title style={colback=white,left=0pt,right=0pt}, 
top=2pt,bottom=2pt,left=2pt,right=2pt,
underlay unbroken={
  \filldraw[fill=gray,draw=gray]
  (frame.south west) -- +(2.5pt,0pt) -- +(2.5pt,5pt) -- +(-2.5pt,5pt) -- (-2.5pt,0pt) -- cycle;
  \filldraw[fill=gray,draw=gray]
  (frame.north west) -- +(2.5pt,0pt) -- +(2.5pt,-5pt) -- +(-2.5pt,-5pt) -- +(-2.5pt,0pt) -- cycle;
  \draw[draw=gray,line width=.5pt]
  (frame.north west)--(frame.south west) ;
  },
underlay first={
  \filldraw[fill=gray,draw=gray]
  (frame.north west) -- +(2.5pt,0pt) -- +(2.5pt,-5pt) -- +(-2.5pt,-5pt) -- +(-2.5pt,0pt) -- cycle;
  \draw[draw=gray,dotted,line width=.5pt]
  (frame.north west)--(frame.south west) ;
  },
underlay middle={
  \draw[draw=gray,line width=.5pt]
  (frame.south west)--(frame.north west) ;
  },
underlay last={
  \filldraw[fill=gray,draw=gray]
  (frame.south west) -- +(2.5pt,0pt) -- +(2.5pt,5pt) -- +(-2.5pt,5pt) -- (-2.5pt,0pt) -- cycle;
  \draw[black,dotted,line width=.5pt]
  (frame.south west)--(frame.north west) ;
  }
}

% 線の太さを簡単に変更できるようになった leftbar 環境
\newtcolorbox{lbar}
{enhanced, colback=white, colframe=white,
fonttitle=\bfseries, coltitle=black, fonttitle=\gtfamily, 
breakable, sharp corners,
boxed title style={colback=white,left=0pt,right=0pt}, 
top=2pt,bottom=2pt,left=2pt,right=2pt,
borderline west={0.75pt}{0pt}{black},
}
% lbar を使った remark 環境
\tcolorboxenvironment{remark}
{enhanced, colback=white, colframe=white,
fonttitle=\bfseries, coltitle=black, fonttitle=\gtfamily, 
breakable, sharp corners,
boxed title style={colback=white,left=0pt,right=0pt}, 
top=2pt,bottom=2pt,left=2pt,right=2pt,
borderline west={0.75pt}{0pt}{black},
}

% 英文解体新書の枠
\newtcolorbox{eng}
{
  enhanced,
  sharp corners,
  breakable,
  colback=white,
  top=2pt,bottom=2pt,left=4pt,right=4pt,
  boxrule=1pt,
  underlay unbroken={
    \filldraw[fill=black!70!white,draw=black!70!white]
    (frame.north east) -- +(2.5pt,-2.5pt) -- ([xshift=2.5pt]frame.south east) -- +(-2.5pt,0pt);
    \filldraw[fill=black!70!white,draw=black!70!white]
    (frame.south west) -- +(2.5pt,-2.5pt) -- ([yshift=-2.5pt]frame.south east) -- +(2.5pt,0pt) -- +(2.5pt,2.5pt) -- cycle;
 },
underlay first={
  \filldraw[fill=black!70!white,draw=black!70!white]
  (frame.north east) -- +(2.5pt,-2.5pt) -- +(0pt,-2.5pt);
  \filldraw[fill=black!70!white,draw=black!70!white]
  (frame.north east) -- +(2.5pt,-2.5pt) -- ([xshift=2.5pt]frame.south east) -- +(-2.5pt,0pt);
  },
underlay middle={
  \filldraw[fill=black!70!white,draw=black!70!white]
  (frame.south west)--(frame.north west) ;
  \filldraw[fill=black!70!white,draw=black!70!white]
  (frame.north east) -- +(2.5pt,0pt) -- ([xshift=2.5pt]frame.south east) -- +(-2.5pt,0pt);
  },
underlay last={
  \filldraw[fill=black!70!white,draw=black!70!white]
   (frame.south west) -- +(2.5pt,-2.5pt) -- ([yshift=-2.5pt]frame.south east) -- +(2.5pt,0pt) -- +(2.5pt,2.5pt) -- cycle;
   \filldraw[fill=black!70!white,draw=black!70!white]
   (frame.south east) -- +(2.5pt,0pt) -- ([xshift=2.5pt]frame.north east) -- +(-2.5pt,0pt);
  },
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
